<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
  <meta name="color-scheme" content="light dark">
  <script async src="js/opencv.js"></script>
  <!-- <link rel="stylesheet" href="css/index.css"> -->
  <title>sketchMaker by abhimanyus1997</title>
</head>

<body>
  <h2>sketchMaker by abhimanyus1997</h2>
  <div>
    <div class="inputoutput">
      <img id="imageSrc" alt="No Image" hidden/>
      <div class="caption">imageSrc <input type="file" id="fileInput" name="file" /></div>
    </div>
    <div>
      <input type="button" value="Load Img" onclick="processImg()">
      <canvas id="canvasOutput" width="240" height="297" style="border:1px solid #d3d3d3;">
    </div>
  </div>
  <script type="text/javascript">
    let imgElement = document.getElementById("imageSrc")
    let inputElement = document.getElementById("fileInput");
    inputElement.addEventListener("change", (e) => {
      imgElement.src = URL.createObjectURL(e.target.files[0]);
    }, false);

    function processImg() {
      let src = cv.imread(imageSrc);
      let grey_img = new cv.Mat();   //stores greyImg
      let invert_img =new cv.Mat(); //storesInvert img

      let ksize = new cv.Size(11, 11);
      let blur_img = new cv.Mat();
      let invblur_img = new cv.Mat();

      let sketch_img = new cv.Mat();
      // To distinguish the input and output, we graying the image.
      // You can try different conversions.

      cv.cvtColor(src, grey_img, cv.COLOR_RGBA2GRAY);
      cv.bitwise_not(grey_img,invert_img)
      cv.GaussianBlur(invert_img,blur_img,ksize, 0, 0, cv.BORDER_DEFAULT)
      cv.bitwise_not(blur_img,invblur_img)
      cv.divide(grey_img,invblur_img,sketch_img, scale=256.0)
      cv.imshow(canvasOutput, sketch_img);

      src.delete();
      grey_img.delete();
      invert_img.delete();
      blur_img.delete();
      invblur_img.delete();
      sketch_img.delete();
    }

  </script>
</body>

</html>